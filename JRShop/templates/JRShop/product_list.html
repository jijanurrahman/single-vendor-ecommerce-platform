{% extends 'JRShop/base.html' %}
{% load static %}

{% block title %}Products - JR E-Shop{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'JRShop/css/product_list.css' %}">
{% endblock %}

{% block content %}
<!-- Navbar -->
<nav class="navbar">
    <div class="navbar-content">
        <a href="{% url 'home' %}" class="navbar-brand">JR E-Shop</a>
        <div class="navbar-menu">
            {% if user.is_authenticated %}
                <a href="{% url 'product_list' %}" class="nav-link active">
                    <span class="nav-icon">üõçÔ∏è</span>
                    <span>Products</span>
                </a>
                <a href="{% url 'view_cart' %}" class="nav-link cart-link">
                    <span class="nav-icon">üõí</span>
                    <span>Cart</span>
                    {% if cart_items_count %}
                    <span class="cart-badge">{{ cart_items_count }}</span>
                    {% endif %}
                </a>
                <a href="{% url 'profile' %}" class="user-info">
                    <div class="user-avatar">{{ user.username|slice:":1"|upper }}</div>
                    <span>{{ user.username }}</span>
                </a>
            {% else %}
                <a href="{% url 'login' %}" class="btn btn-primary">Login</a>
                <a href="{% url 'register' %}" class="btn btn-secondary">Register</a>
            {% endif %}
        </div>
    </div>
</nav>

<div class="products-container">
    <!-- Sidebar Filters -->
    <aside class="filters-sidebar">
        <div class="filters-header">
            <h3>üîç Filters</h3>
        </div>

        <form method="GET" class="filters-form">
            <!-- Search -->
            <div class="filter-group">
                <label class="filter-label">Search Products</label>
                <input 
                    type="text" 
                    name="search" 
                    class="filter-input" 
                    placeholder="Search..."
                    value="{{ request.GET.search }}"
                >
            </div>

            <!-- Categories -->
            <div class="filter-group">
                <label class="filter-label">Category</label>
                <div class="categories-list">
                    <a href="{% url 'product_list' %}" class="category-link {% if not category %}active{% endif %}">
                        All Products
                    </a>
                    {% for cat in categories %}
                    <a href="{% url 'product_list_by_category' cat.slug %}" class="category-link {% if category.id == cat.id %}active{% endif %}">
                        {{ cat.name }}
                    </a>
                    {% endfor %}
                </div>
            </div>

            <!-- Price Range -->
            <div class="filter-group">
                <label class="filter-label">Price Range</label>
                <div class="price-inputs">
                    <input 
                        type="number" 
                        name="min_price" 
                        class="filter-input" 
                        placeholder="Min"
                        value="{{ request.GET.min_price }}"
                    >
                    <span class="price-separator">-</span>
                    <input 
                        type="number" 
                        name="max_price" 
                        class="filter-input" 
                        placeholder="Max"
                        value="{{ request.GET.max_price }}"
                    >
                </div>
            </div>

            <!-- Rating Filter -->
            <div class="filter-group">
                <label class="filter-label">Minimum Rating</label>
                <select name="rating" class="filter-input">
                    <option value="">All Ratings</option>
                    <option value="1" {% if request.GET.rating == '1' %}selected{% endif %}>1‚òÖ & Up</option>
                    <option value="2" {% if request.GET.rating == '2' %}selected{% endif %}>2‚òÖ & Up</option>
                    <option value="3" {% if request.GET.rating == '3' %}selected{% endif %}>3‚òÖ & Up</option>
                    <option value="4" {% if request.GET.rating == '4' %}selected{% endif %}>4‚òÖ & Up</option>
                    <option value="5" {% if request.GET.rating == '5' %}selected{% endif %}>5‚òÖ Only</option>
                </select>
            </div>

            <button type="submit" class="filter-btn">Apply Filters</button>
        </form>
    </aside>

    <!-- Products Grid -->
    <main class="products-main">
        <!-- Header -->
        <div class="products-header">
            <div class="header-content">
                <h1 class="products-title">
                    {% if category %}
                        {{ category.name }}
                    {% else %}
                        All Products
                    {% endif %}
                </h1>
                <p class="products-count">{{ products.count }} products found</p>
            </div>
        </div>

        <!-- Products Grid -->
        {% if products %}
        <div class="products-grid">
            {% for product in products %}
            <div class="product-card" data-product-id="{{ product.id }}">
                <!-- Image Container -->
                <div class="product-image-container">
                    {% if product.image %}
                    <img src="{{ product.image.url }}" alt="{{ product.name }}" class="product-image">
                    {% else %}
                    <div class="product-image-placeholder">
                        <svg viewBox="0 0 24 24">
                            <path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/>
                        </svg>
                    </div>
                    {% endif %}
                    
                    <!-- Stock Badge -->
                    <div class="stock-badge {% if product.stock > 0 %}in-stock{% else %}out-of-stock{% endif %}">
                        {% if product.stock > 0 %}
                            In Stock ({{ product.stock }})
                        {% else %}
                            Out of Stock
                        {% endif %}
                    </div>

                    <!-- Quick View Button -->
                    <a href="{% url 'product_detail' product.slug %}" class="quick-view-btn">
                        üëÅÔ∏è Quick View
                    </a>
                </div>

                <!-- Product Info -->
                <div class="product-info">
                    <h3 class="product-name">{{ product.name }}</h3>
                    
                    <!-- Category -->
                    <p class="product-category">{{ product.category.name }}</p>

                    <!-- Description -->
                    <p class="product-description">
                        {{ product.description|truncatewords:15 }}
                    </p>

                    <!-- Price -->
                    <div class="product-price">
                        {% if product.has_discount %}
                            <div class="price-container">
                                <span class="original-price">‡ß≥{{ product.price }}</span>
                                <span class="discount-price">‡ß≥{{ product.discount_price }}</span>
                            </div>
                            <div class="discount-badge">
                                <span class="discount-percent">{{ product.get_discount_percentage }}% OFF</span>
                            </div>
                        {% else %}
                            <span class="price">‡ß≥{{ product.price }}</span>
                        {% endif %}
                    </div>

                    <!-- Add to Cart Button -->
                    {% if product.stock > 0 %}
                        <a href="{% url 'add_to_cart' product.id %}" class="add-to-cart-btn">
                            <span class="btn-icon">üõí</span>
                            <span class="btn-text">Add to Cart</span>
                        </a>
                    {% else %}
                        <button class="add-to-cart-btn disabled" disabled>
                            <span class="btn-icon">‚ùå</span>
                            <span class="btn-text">Out of Stock</span>
                        </button>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="no-products">
            <div class="no-products-icon">üì¶</div>
            <h2>No Products Found</h2>
            <p>Try adjusting your filters or search terms</p>
            <a href="{% url 'product_list' %}" class="reset-btn">View All Products</a>
        </div>
        {% endif %}
    </main>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'JRShop/js/product_list.js' %}"></script>
{% endblock %}
